# 学习周报 （2019上半学期第8周）

## 本周具体工作计划

- 制作windows7或者centos7或者ubuntu的镜像，格式为qcow2
- 利用openstack上传镜像
- 能够成功创建、开启实例

## 本周主要工作内容

- 制作镜像：先下载要制作镜像的iso文件，启动系统

- 在镜像中添加一个文件，文件内容写入branch名称，保存

- 用命令行或dashboard创建镜像

- 查看镜像的信息、服务

- 创建该镜像的实例

- 实例能够ping通外网

- 尝试用xshell或者桌面远程连接实例（安全组）

- 开启实例后能够打开之前创建的文件

## 已经完成工作

- 制作镜像：先下载要制作镜像的iso文件，启动系统

- 在镜像中添加一个文件，文件内容写入branch名称，保存

- 用命令行或dashboard创建镜像

- 查看镜像的信息、服务

- 创建该镜像的实例

- 实例能够ping通外网

- 开启实例后能够打开之前创建的文件

- 尝试用xshell或者桌面远程连接实例（安全组）


## 未完成工作


## 问题与困难

尝试在本地虚拟机中进行，遇到很多aptget的问题

## 下周工作计划


---

## task3操作文档

### 尝试本地虚拟机

- 首先检查是否有如下命令 

![](./image/3_01.png)

发现virt-install不存在，进行安装

![](./image/3_02.png)

安装失败，百度一些`has no installation candidate`相关问题，发现涉及apt-get update 和 upgrade，但是好像记得ta说不要upgrade，遂放弃使用自己的虚拟机

### 使用服务器

添加用户先略过不谈，添加好只后切换到新用户

- 首先检查是否有如下命令 

![](./image/3_03.png)

- 接着检查 virt 是否有 default 网络 

![](./image/3_04.png)

- 可见已经有配置，我们查看下配置文件

![](./image/3_05.png)

- 在目录下创建image文件夹并上传centos7文件

![](./image/3_06.png)

- 创建 qcow2 文件 

![](./image/3_07.png)

- 创建 vm，安装 centos7 

![](./image/3_08.png)

选择了5920端口，于同学的5919区别

可以看到运行

![](./image/3_09.png)


- 使用 vnc-viewer 连接 vm，进行系统安装 

![](./image/3_10.png)

进行系统安装，等待完成

![](./image/3_11.png)

安装完成，进行重启

![](./image/3_12.png)

重新使用vnc-viewer 连接 vm，创建学号姓名命名的文件

![](./image/3_13.png)

- 创建，并登录 Openstack 查看镜像 

![](./image/3_14.png)


![](./image/3_15.png)

- 创建实例

![](./image/3_16.png)

- ping 外网

![](./image/3_17.png)

- 配置安全组并用远程ssh

查了一些自己本机的公网ip，emmm写个应该说是很随便的ssh远程ip限制

![](./image/3_19.png)

ssh链接成功

![](./image/3_18.png)



- 打开之前创建的文件

![](./image/3_20.png)

## 周报

### iso和qcow2、img格式的区别

- ISO：符合ISO9660标准的光盘镜像文件
    这种文件可以简单的理解为复制光盘上全部信息而形成的镜像文件。

- qcow2: qemu的cow格式
    更小的存储空间，即使是不支持holes的文件系统也可以
    Copy-on-write support, where the image only represents changes made to an underlying disk
    image（这个特性SUN ZFS表现的淋漓尽致）
    支持多个snapshot，对历史snapshot进行管理
    支持zlib的磁盘压缩
    支持AES的加密

- img:IMG是一种文件压缩格式（archive format），主要是为了创建软盘的镜像文件（disk image），它可以用来压缩整个软盘（通常指软软盘，Floppy Disk或Diskette）或整片光盘的内容，使用".IMG"这个扩展名的文件就是利用这种文件格式来创建的。

### 为什么要自己制作镜像

为了更好的满足自己的需求，必比如非常裸的raw，裸的彻底，性能上来说的话还是不错的，而且挂载也很容易。转换成其它格式的虚拟机镜像也很简单。

### 镜像制作到启动的步骤总结

- 环境的准备：qemu-img（QEMU的磁盘管理工具,）, virsh（管理虚拟机相关）, virt-install（创建虚拟机）；

- qcow2虚拟磁盘镜像的创建

- 虚拟机的安装和启动

- 将qcow2的文件用openstack上传创建镜像

- 在openstak中使用镜像创建实例

- 启动实例

### 跟镜像相关的openstack的一些命令了解

列出您可以访问的镜像

```$ openstack image list```
删除指定的镜像

```$ openstack image delete IMAGE```
描述一个指定的镜像

```$ openstack image show IMAGE```
更新镜像

```$ openstack image set IMAGE```
上传内核镜像

```
$ openstack image create "cirros-threepart-kernel" \
  --disk-format aki --container-format aki --public \
  --file ~/images/cirros-0.3.5-x86_64-kernel
```

上传RAM镜像

```
$ openstack image create "cirros-threepart-ramdisk" \
  --disk-format ari --container-format ari --public \
  --file ~/images/cirros-0.3.5-x86_64-initramfs
```

上传第三方镜像

```
$ openstack image create "cirros-threepart" --disk-format ami \
  --container-format ami --public \
  --property kernel_id=$KID-property ramdisk_id=$RID \
  --file ~/images/cirros-0.3.5-x86_64-rootfs.img
  ```
注册raw镜像

```
$ openstack image create "cirros-raw" --disk-format raw \
  --container-format bare --public \
  --file ~/images/cirros-0.3.5-x86_64-disk.img
  ```