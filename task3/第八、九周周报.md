# 本周具体工作计划  
+ 制作windows7或者centos7或者ubuntu的镜像，格式为qcow2
- 利用openstack上传镜像
+ 能够成功创建、开启实例  

## 具体描述：  
+ 制作镜像：先下载要制作镜像的iso文件，启动系统
- 在镜像中添加一个文件，文件内容写入branch名称，保存
+ 用命令行或dashboard创建镜像
- 查看镜像的信息、服务
+ 创建该镜像的实例
- 实例能够ping通外网
+ 尝试用xshell或者桌面远程连接实例（安全组）
- 开启实例后能够打开之前创建的文件  
  
## 已完成工作  
完成既定工作计划并实现了远程连接  
  
## 未完成工作  
无  
  
# 第八周学习周报  
### iso和qcow2、img格式的区别  
- iso，国际标准光盘文件系统格式。符合ISO 9660标准的光盘镜像文件格式，文件扩展名通常为iso。这种文件可以简单的理解为复制光盘上全部信息而形成的镜像文件。  
+ IMG是一种文件压缩格式（archive format），主要是为了创建软盘的镜像文件（disk image），它可以用来压缩整个软盘（通常指软软盘，Floppy Disk或Diskette）或整片光盘的内容，使用".IMG"这个扩展名的文件就是利用这种文件格式来创建的。
.IMG这个文件格式可视为.ISO格式的一种超集合。由于.ISO只能压缩使用ISO9660和UDF这两种文件系统的存储媒介，意即.ISO只能拿来压缩CD或DVD，因此才发展出了.IMG，它是以.ISO格式为基础另外新增可压缩使用其它文件系统的存储媒介的能力，.IMG可向后兼容于.ISO，如果是拿来压缩CD或DVD，则使用.IMG和.ISO这两种格式所压缩出来的内容是一样的。打开方式可以是光盘刻录，也可以用软件解压。  
+ qcow2镜像格式是QEMU模拟器支持的一种磁盘镜像。它也是可以用一个文件的形式来表示一块固定大小的块设备磁盘。与普通的原始格式的镜像相比，有以下特性：  
   + 更小的空间占用，即使文件系统不支持空洞（空穴）;
   - 支持写时拷贝（COW，copy-on-write），镜像文件只反映底层磁盘的变化;
   + 支持快照（快照），镜像文件能够包含多个快照的历史;
   + 可选择基于zlib的压缩方式
   + 可以选择AES加密  
   
### 为什么要自己制作镜像  
+ 首先，建立映像文件能提高刻录成功的几率，因为刻录资料的过程包括读取文件、转换格式和实际写入等阶段，在正式刻录过程中只要一个阶段出现问题都会造成刻录失败。而制作映像文件则能很好地控制这些过程，增加刻录成功的机会；
+ 其次，制作映像文件最大的好处在于可方便地进行同样资料的大量复制，能节省不少直接写入方式的重复时间；
- 另外，建立映像文件进行刻录时不会产生许多小容量的文件，这样在刻录过程中能避免Buffer underrun(缓存不足)的产生。  

### 镜像制作到启动的步骤总结  
+ 上传磁盘映像，如iso,img等格式
- 利用上传的映像创建虚拟磁盘映像，比如raw,qcow2等
+ 创建vm，安装系统，然后对vm进行需要的个性化环境配置
+ 将 qcow2 文件上传到 openstack
+ 在openstack中利用qcow2映像创建实例
+ 启动实例，至此启动完成，可以开始使用  
  
### 跟镜像相关的openstack的一些命令  
##### 修改CentOS的虚拟机镜像、设置一个默认的root密码的步骤如下：  
```
# yum install -y libguestfs-tools
# guestfish --rw -a /var/lib/libvirt/images/CentOS-7-x86_64-GenericCloud-1805.qcow2
# 注意: 运行guestfish命令的用户必须和虚拟机镜像文件的属主是同一个，否则接下来的操作会失败。
# guestfish命令运行后示例如下：
Welcome to guestfish, the guest filesystem shell for
editing virtual machine filesystems and disk images.

Type: 'help' for help on commands
      'man' to read the manual
      'quit' to quit the shell

><fs> run
><fs> list-filesystems
/dev/sda1: xfs
><fs> mount /dev/sda1 /
><fs> vi /etc/shadow # 将root后的两个冒号之间的内容改成新的加密字符串，可以从别的主机上的/etc/shadow文件中复制过来。
><fs> quit

```
  
#### 上传镜像到openstack：  
```  
export OS_PROJECT_DOMAIN_NAME=Default
export OS_USER_DOMAIN_NAME=Default
export OS_PROJECT_NAME=admin
export OS_USERNAME=admin
export OS_PASSWORD=adminpassword
export OS_AUTH_URL=http://controller:5000/v3
export OS_IDENTITY_API_VERSION=3
export OS_IMAGE_API_VERSION=2

```  

#### 列出全部镜像（比nova image-list更加详细）：
``` 
glance index
glance image-list

```  

#### 查看image具体信息(ID通过glance index查看获得）：
```
glance show ID

```  

#### 上传镜像：
```
glance image-create --visibility public --container-format docker/bare --disk-format raw/qcow2 --name xxx --file /root/xxx --progress

```

### 实验过程记录  
检查default网络  

![default网络](https://github.com/2019cloudcomputingpractices/CloudComputingCourse/blob/16340124-%E6%9D%8E%E8%A8%80/task3/images/default%E7%BD%91%E7%BB%9C.png)  
  
创建vm，安装centos7  
  
![virsh list](https://github.com/2019cloudcomputingpractices/CloudComputingCourse/blob/16340124-%E6%9D%8E%E8%A8%80/task3/images/virsh%20list.png)  
  
vnc-viewer连接，登录自己创建的用户  
  
![VNC](https://github.com/2019cloudcomputingpractices/CloudComputingCourse/blob/16340124-%E6%9D%8E%E8%A8%80/task3/images/VNC.png)  
  
qcow2上传到openstack得到的信息表格  
  
![excess](https://github.com/2019cloudcomputingpractices/CloudComputingCourse/blob/16340124-%E6%9D%8E%E8%A8%80/task3/images/excess.png)  
  
实例ping外网 
  
![ping](https://github.com/2019cloudcomputingpractices/CloudComputingCourse/blob/16340124-%E6%9D%8E%E8%A8%80/task3/images/ping.png)  
  
w7镜像，qcow2上传到openstack得到的信息表格  
  
![excess2](https://github.com/2019cloudcomputingpractices/CloudComputingCourse/blob/16340124-%E6%9D%8E%E8%A8%80/task3/images/excess2.png)  
  
horizon界面实例控制台  
  
![w7 cirros](https://github.com/2019cloudcomputingpractices/CloudComputingCourse/blob/16340124-%E6%9D%8E%E8%A8%80/task3/images/w7%20cirros.png)  
  
更新驱动  
  
![驱动](https://github.com/2019cloudcomputingpractices/CloudComputingCourse/blob/16340124-%E6%9D%8E%E8%A8%80/task3/images/%E9%A9%B1%E5%8A%A8.png)  
  
实现远程连接  
  
![远程访问](https://github.com/2019cloudcomputingpractices/CloudComputingCourse/blob/16340124-%E6%9D%8E%E8%A8%80/task3/images/%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE.png)  
  
## 问题与困难
**实现远程连接遇到了用户名或者密码错误的情况，查阅很多资料才找到解决办法，是要让win10本地的主机管理员用户名与用户全名一致才行，而我windows用的是Microsoft账号登录，所以全名多了自己的id，所以一直失败(而且并不知道哪儿出错了，可能存在的错误有需根据动态ip调整ip地址、子网掩码等；用户名错误；win7远程连接步骤等等……)，比较受挫折**  
  
 ![bug](https://github.com/2019cloudcomputingpractices/CloudComputingCourse/blob/16340124-%E6%9D%8E%E8%A8%80/task3/images/bug.png)  
 
**其余进行的都较为顺利，按图索骥，没什么问题。**


