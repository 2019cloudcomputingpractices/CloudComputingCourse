# task3操作文档

## 任务：

- 制作windows7或者centos7或者ubuntu的镜像，格式为qcow2，本次选择以制作centos7镜像为例
- 利用openstack上传镜像
- 能够成功创建、开启实例



## 具体操作

上周主要是利用一个比较小的镜像来测试虚拟网络，这次尝试制作我们常用的一些镜像。

### 1. 制作镜像：先下载要制作镜像的iso文件，启动系统

（1）通过Putty登录安装好openstack的服务器

![1.1-登录](images/1.1-%E7%99%BB%E5%BD%95.png?raw=true)



（2）添加用户

![1.2-添加用户](images/1.2-%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7.png?raw=true)



（3）确认新建用户具备sudo权限

![1.3-确认](images/1.3-%E7%A1%AE%E8%AE%A4.png?raw=true)



（4）检查相关工具是否已安装

![2.1-检查](images/2.1-%E6%A3%80%E6%9F%A5.png?raw=true)



（5）查看default网络是否已创建

![2.2-检查](images/2.2-%E6%A3%80%E6%9F%A5.png?raw=true)

结果显示default网络已经创建并处于活跃状态，若未创建，则需要在/etc/libvirt/qemu/networks/下创建default.xml并启动网络，配置内容如下：

![2.2-查看](images/2.2-%E6%9F%A5%E7%9C%8B.png?raw=true)



（6）创建存放镜像的目录，将系统镜像上传至服务器

![3.1-创建目录](images/3.1-%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95.png?raw=true)

通过pscp上传centos镜像

![3.2-上传](images/3.2-%E4%B8%8A%E4%BC%A0.png?raw=true)



（7）创建qcow2镜像文件

![3.3-创建qcow2](images/3.3-%E5%88%9B%E5%BB%BAqcow2.png?raw=true)

可以发现创建好的镜像文件实际占用的空间只有196K，而非10G。



（8）创建虚拟机

![3.4-创建虚拟机](images/3.4-%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA.png?raw=true)

查看虚拟机是否已经在运行

![3.4-查看](images/3.4-%E6%9F%A5%E7%9C%8B.png?raw=true)

之后可用vnc viewer远程连接到该虚拟机，根据系统安装引导的提示完成系统的安装。



（9）重启虚拟机

安装完系统后在虚拟机中点击重启，虚拟机只会关闭，但不会重新启动，所以需要手动启动。

![3.5-重启](images/3.5-%E9%87%8D%E5%90%AF.png?raw=true)



（10）在虚拟机上创建文件

![3.6-创建文件](images/3.6-%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6.png?raw=true)



### 2. 用命令行或dashboard创建镜像

（1）用命令行创建镜像

![3.7-上传镜像](images/3.7-%E4%B8%8A%E4%BC%A0%E9%95%9C%E5%83%8F.png?raw=true)



（2）在dashboard上查看创建的镜像

![3.7-查看镜像](images/3.7-%E6%9F%A5%E7%9C%8B%E9%95%9C%E5%83%8F.png?raw=true)



### 3. 创建并启动实例

（1）使用新建的镜像创建并启动实例

![3.7-实例](images/3.7-%E5%AE%9E%E4%BE%8B.png?raw=true)



（2）按照上次实验的方法为实例绑定浮动IP



### 4. 检查实例

（1）检查能否访问外网

进入的实例控制台并ping外网某一IP

![3.7-ping外网](images/3.7-ping%E5%A4%96%E7%BD%91.png?raw=true)



（2）尝试用xshell或者桌面远程连接实例（安全组）

这里依然以Putty对实例进行远程连接，通过实例的浮动IP及制作镜像过程中设置的用户名和密码即可远程连接该实例。



（3）开启实例后能够打开之前创建的文件

![3.7-查看文件](images/3.7-%E6%9F%A5%E7%9C%8B%E6%96%87%E4%BB%B6.png?raw=true)