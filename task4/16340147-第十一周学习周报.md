# 本周具体工作计划
+ 安装云桌面
+ 云桌面系统功能体验
+ 了解云桌面相关背景知识

# 本周主要工作内容
+ 提供vindesk部署安装包，根据安装文档来安装
+ 创建固定桌面
+ 创建一个课程，并创建一个对应的课程桌面，课程名称请命名为自己的分支

## 已完成工作
效果图如下：
安装完服务后确认服务是否在运行：
![](https://raw.githubusercontent.com/2019cloudcomputingpractices/CloudComputingCourse/16340147-%E5%88%98%E6%81%92%E4%BC%9F/task4/image/1.png)
添加课程：
![](https://raw.githubusercontent.com/2019cloudcomputingpractices/CloudComputingCourse/16340147-%E5%88%98%E6%81%92%E4%BC%9F/task4/image/2.png)
创建课程桌面：
![](https://raw.githubusercontent.com/2019cloudcomputingpractices/CloudComputingCourse/16340147-%E5%88%98%E6%81%92%E4%BC%9F/task4/image/3.png)
创建固定桌面：
![](https://raw.githubusercontent.com/2019cloudcomputingpractices/CloudComputingCourse/16340147-%E5%88%98%E6%81%92%E4%BC%9F/task4/image/9.png)
课程信息如下：
![](https://raw.githubusercontent.com/2019cloudcomputingpractices/CloudComputingCourse/16340147-%E5%88%98%E6%81%92%E4%BC%9F/task4/image/8.png)
登录云桌面成功：
![](https://raw.githubusercontent.com/2019cloudcomputingpractices/CloudComputingCourse/16340147-%E5%88%98%E6%81%92%E4%BC%9F/task4/image/4.png)
连接云桌面成功：
![](https://raw.githubusercontent.com/2019cloudcomputingpractices/CloudComputingCourse/16340147-%E5%88%98%E6%81%92%E4%BC%9F/task4/image/7.png)
创建一个教师：
![](https://raw.githubusercontent.com/2019cloudcomputingpractices/CloudComputingCourse/16340147-%E5%88%98%E6%81%92%E4%BC%9F/task4/image/5.png)
创建一个学生：
![](https://raw.githubusercontent.com/2019cloudcomputingpractices/CloudComputingCourse/16340147-%E5%88%98%E6%81%92%E4%BC%9F/task4/image/6.png)
可以看到已经满足了实验要求，可以远程连接win7的桌面了，并且之前在vm中的文件也依然存在

### 云桌面相关背景知识
#### VDI概念解释以及实现原理
VDI是Virtual Desktop Infrastructure的缩写，即虚拟桌面架构。虚拟桌面架构采用"集中计算，分布显示"的原则，通过虚拟化技术，将所有客户端的运算合为一体，在企业数据中心内进行集中处理，而桌面用户采用瘦客户端或专用小型终端机的方式，仅负责输入输出与界面显示，不参与任何计算和应用。
相比于终端服务和刀片PC来说，VDI具有很多优势，其有针对每个用户的隔离环境、利用了现有了桌面工具、不改变应用程序的工作方式、共享CPU网卡等资源、可以进行负载均衡并且还有一定的拓展性。
简化版，即不在乎防火墙等细节的VDI架构图大致如下：
![](https://raw.githubusercontent.com/2019cloudcomputingpractices/CloudComputingCourse/16340147-%E5%88%98%E6%81%92%E4%BC%9F/task4/image/10.png)
作为虚拟机的使用者，用户需要使用终端进行登录，然后客户端连接调度服务器会在这里进行一些有关负载均衡的操作，然后再和虚拟化平台交互，虚拟化平台也就是所有虚拟机计算的集中地，也就是数据中心等地，所有虚拟机的物理媒介都在虚拟化平台中，而虚拟机管理服务器即可以对虚拟化平台进行管理，比如进行创建虚拟机，删除虚拟机等操作都是从虚拟机管理服务器发送相关信息，然后在虚拟化平台中进行执行。这次实验我们部署的实际上就是一个虚拟机管理服务器，而云端的openstack就相当于是虚拟化平台。

#### 实现的协议介绍（spice、vnc、rdp），进行对比
##### vnc
适用系统：windows、linux

网络流量：较小，常用100k左右

适用场景：主要用于linux的服务器的管理，由于无声音和usb传输，不满足于虚拟桌面的使用
##### spice
适用系统：linux

网络流量：较大，正常使用10-20M

适用场景：由于在色彩、音频和usb方面，适用于虚拟桌面，主要用于虚拟机的虚拟桌面应用
##### rdp
目前在windows上 rdp有两种，remote，remotefx

适用系统：windows、linux

网络流量：较小，正常使用100-200k左右

适用场景：由于在色彩、音频、usb及本地磁盘映射方面较好，非常适用于虚拟桌面

下表可以清楚看到三种协议的区别：
![](https://raw.githubusercontent.com/2019cloudcomputingpractices/CloudComputingCourse/16340147-%E5%88%98%E6%81%92%E4%BC%9F/task4/image/11.png)


## 未完成工作
好像没有，可能云桌面管理系统的一些冷门的功能还不是很会用
## 问题与困难
根据人品守恒定律，前几次实验都很顺利，这次实验肯定是要翻车的，本来一开始配置的还挺顺利的，然后手贱选了win7的桌面，这就是祸源的开始，首先我因为选的是small，空间小于30G，所以在openstack里面可以很清楚的看到实例没有创建成功，所以我就想删掉实例然后修改配置重新配，但是这个辣鸡系统很玄学的就让我的课程一直在处理中，反正也不知道是在处理啥，处理了大半个小时都没处理完，然后删又删不掉，后面又很手贱的去重新运行了一遍run.sh，让整个系统彻底用不了了，然后这个辣鸡系统tm竟然连个卸载脚本都没提供，我就只好去重装了一下系统，装完马上运行run.sh后发现连不上mysql，所以我就卸载了mysql，重新安了一遍，然后发现在安装的时候根本没有让我去设置root的密码，然后默认的密码又没告诉我，然后我只好修改mysql的配置文件，先去掉密码登录，进里面把root密码改成了admin123，后面再运行了一遍就成功安上了，然后创建win7桌面的时候显示异常，之前TA提示过这个是因为防火墙的问题，然后我点进去，用spice协议连接桌面，把防火墙关了，然后我ping了一下云桌面，发现可以ping通了，然而这个辣鸡系统竟然没有做持续连接的那种测试，搞的一直都在异常，我本着试试看的态度尝试用云桌面客户端连接，发现可以登录上，但是一直显示需要唤醒，然后唤醒又唤醒不了，后面我就借了隔壁的centos镜像重新创建了一个centos实例，然后一切就都是那么正常了。但是这个时候因为已经隔天，我尝试在云桌面客户端登录，发现昨天晚上能连上的服务器莫名其妙就连不上了，后面我以为是管理系统的问题，就一直在/var/log目录下看那些log，然后发现这些log写的又臭又长，根本不是人看的，那个all.log我一度认为是为了log而log，根本没法用，整个log文件夹连专门保存报错的log都没有，后面我想了下是不是客户端的问题，然后果然在客户端的log文件夹的log文件里面看到了“System.Net.Sockets.SocketException: 由于目标计算机积极拒绝，无法连接。 127.0.0.1:1080”这样一行，我就明白了原来客户端用的是http协议，然而我是给http设过代理的，因为我谷歌浏览器有相关的插件才可以访问国内网站直连，其他的http流量全部走的是IE代理，然而我代理软件根本就没开，我把IE的代理关了后一切就都正常了。
## 建议与意见
辣鸡系统，毁我青春