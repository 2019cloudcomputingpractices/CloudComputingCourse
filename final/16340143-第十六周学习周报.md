## 本周具体工作计划

完成以下内容：

- FTP服务器的基本设计

## 本周主要工作内容

### i. 已经完成工作

#### 1.ftp服务器的基本设计

Server类：工作在主线程，通过循环accept新的连接，并将新的连接作为参数创建一个Connection实例，并让Connection实例在新的线程中执行。

```c++
class Server {
 private:
  std::atomic<int> thread_counter;
  int port_;
 public:
  Server(int port): port_(port), thread_counter(1) {}
  void Start();
  void NewConnection(int sock);
};

```



Connection类：每个Connection类工作在单独的线程，负责处理客户端连接，每个客户端连接由一个Connection实例处理。

```c++
class Connection {
  ...
  int sock_;
  int sock_pasv_;
  bool logged_in_;
  enum Mode {kNormal, kServer, kClient} mode_;
  enum Status {kRunning, kClosed} status_;
  void Response(const Command   &cmd);
  void SendMessage(const char* message);
  void FtpAbor(const char* arg);
  void FtpCwd (const char* arg);
  ...
};
```

Connection实例从socket中读取客户端发送的命令，解析后调用实现了相应命令的函数进行处理，再将响应返回客户端。当一个FTP连接结束时，Connection实例所在线程便自动结束。



Command类

```c++
struct Command {
  char command[5];
  char arg[kCommandArgSize];
  explicit Command(const char* buf) {
    sscanf(buf, "%s %s", command, arg);
  }
};
```



### ii. 未完成工作

FTP服务器的优化

FTP服务器的性能测试

### iii. 问题与困难

无

## 下周工作计划

FTP服务器的优化

## 建议与意见

无