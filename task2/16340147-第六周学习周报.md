# 本周具体工作计划
openstack虚拟网络配置以及开启实例
# 本周主要工作内容
## 已完成工作
在虚拟机上完成了openstack单节点的部署
效果图如下：
添加映像：
![](https://raw.githubusercontent.com/2019cloudcomputingpractices/CloudComputingCourse/16340147-%E5%88%98%E6%81%92%E4%BC%9F/task2/image/cirros.png)
外部网络：
![](https://raw.githubusercontent.com/2019cloudcomputingpractices/CloudComputingCourse/16340147-%E5%88%98%E6%81%92%E4%BC%9F/task2/image/ext-network.png)
内部网络：
![](https://raw.githubusercontent.com/2019cloudcomputingpractices/CloudComputingCourse/16340147-%E5%88%98%E6%81%92%E4%BC%9F/task2/image/inner-network.png)
实例配置：
![](https://raw.githubusercontent.com/2019cloudcomputingpractices/CloudComputingCourse/16340147-%E5%88%98%E6%81%92%E4%BC%9F/task2/image/instance.png)
网络配置：
![](https://raw.githubusercontent.com/2019cloudcomputingpractices/CloudComputingCourse/16340147-%E5%88%98%E6%81%92%E4%BC%9F/task2/image/network.png)
成功ping通外网：
![](https://raw.githubusercontent.com/2019cloudcomputingpractices/CloudComputingCourse/16340147-%E5%88%98%E6%81%92%E4%BC%9F/task2/image/pingbaidu.png)
成功ping通另外两个实例：
![](https://raw.githubusercontent.com/2019cloudcomputingpractices/CloudComputingCourse/16340147-%E5%88%98%E6%81%92%E4%BC%9F/task2/image/ping-inner.png)
路由配置：
![](https://raw.githubusercontent.com/2019cloudcomputingpractices/CloudComputingCourse/16340147-%E5%88%98%E6%81%92%E4%BC%9F/task2/image/router.png)
可以看到配置已经基本完成，实例也可以互相ping通，实例在配置浮动IP后也可以成功ping通百度。
这次实验的重点主要是网络配置，首先openstack里面的网络有以下几种：

+ VLAN network：基于物理 VLAN 网络实现的虚拟网络。多个 VLAN 网络相互隔离，甚至可以使用重叠的 IP 地址空间。每个支持 VLAN network 的物理网络可以被视为一个分离的 VLAN trunk，使用一组独占的 VLAN ID（VLAN ID 有效范围 1 到 4094）。

+ Flat network：基于不使用 VLAN 的物理网络实现的虚拟网络。每个物理网络最多只能实现一个Flat虚拟网络。

+ Local network：本地网络，只允许在本服务器内通信的虚拟网络，不支持跨服务器的通信。主要用于单节点上测试。

+ GRE network：使用 GRE 封装网络包的虚拟网络。GRE 封装的数据包基于 IP 路由表来进行路由，因此 GRE network 不和具体的物理网络绑定。

+ VXLAN network：基于 VXLAN 实现的虚拟网络。同 GRE network 一样， VXLAN network 中 IP 包的路由基于 IP 路由表，不和具体物理网络绑定。

这次的实验中，我们的int(即内部网络)就属于上面的vxlan，而我们的ext(即外部网络)就属于上面的flat network，从vmware的配置也可以看出，外部网络我们使用的是仅主机模式，独占了一个物理网络，在配置的时候地址也要和物理网络的地址相对应。

同样在本次实验中，我们还接触到了浮动ip(floating ip)，其作用就是能够让外网直接访问租户网络中的 instance，这是通过在 router 上应用 iptalbes 的 NAT 规则实现的。 这样instance在外部看来其ip就是浮动ip，在外部访问这个ip的时候，openstack的网络组件就会将其转换为其私有ip，然后再进行访问，同理被赋予浮动ip的主机要访问外部网络时也会通过NAT进行地址转换，转换成浮动ip然后再访问外网。浮动ip是动态的，其不会自动赋给实例，而需要实例自己从ip池中请求并获取，每次重启实例获取到的浮动ip也是不一样的，而是会从地址池中随机获取一个。实例自己是不知道自己有这个ip的，我们进入实例控制台后也发现其实只有一张负责内部网络的网卡，因此可以看出floating IP 是配置在router的外网interface上的，而非instance。

要创建一个实例，首先需要一个实例源，在本次试验中我们采用的是cirros映像，然后需要添加网络，此外还可选配置安全组，密钥对，元数据等。
因为我们是在图形化界面中完成创建实例的操作，因此会用到horizon，创建实例操作本身用到的是nova，同样因为要配置网络所以要用到neutron，要用到镜像所以要用到glance，此外根据实例的功能需要还可能用到keystone,swift,cinder.
## 未完成工作
好像没有
## 问题与困难
这次实验还是比较顺利的，遇到的问题主要有两个：

（1）首先因为虚拟机的内存不够所以需要添加内存，但是在我在虚拟机开机状态下去调整其内存的时候，发现其最高只能达到3GB,而3GB还是会有out of memory的问题，后面尝试关机后才有了4GB以上的选项，设置后重新开机问题得以解决。

（2）第二就是浮动ip联网的问题，我已经配置好了浮动ip，但是发现还是不能连上网，后面根据TA细心的提示，把原来的网卡取消了共享，然后再次设置了共享，重新设置一遍后cirros-2实例就可以成功ping通外网了。
## 建议与意见
这次好像没有，TA写的教程很贴心，很实用，感谢TA大大