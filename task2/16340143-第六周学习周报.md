## 本周具体工作计划

学习OpenStack中网络的分类，了解浮动IP，理解各核心组件的交互等。



## 本周主要工作内容

### i. 已经完成工作

#### 1. OpenStack网络的分类

按照网络的类型，Neutron network可分为：

（1）**VLAN（Virtual Local Area Network）** ：基于物理VLAN网络实现的虚拟网络。多个VLAN网络相互隔离，甚至可以使用重叠的IP地址空间。每个支持VLAN的物理网络可以被视为一个分类的VLAN trunk，使用一组独占的VLAN ID（有效范围1-4094，因此只支持最多4000个VLAN左右，在实际的云环境往往不够用）。

（2）**VXLAN（Virtual Extensible LAN）**：虚拟可扩展局域网，可以简单理解于VLAN的扩展版。VXLAN的目的是在云计算环境中创建更多的逻辑网络。在云计算的多租户环境中，租户都需要一个逻辑网络，并且与其他逻辑网络能够进行很好的隔离。该技术由思科联合VMware推出，通过MAC in User Datagram Protocol（MAC-in-UDP）封装技术，加入了一个24位的段标识符。用UDP的多播代替广播，将数据包限定在目标网段内。VXLAN技术极大的扩充了云计算环境中所能支持的逻辑网络的数量，同时通过逻辑段可以将逻辑网络扩展到不同的子网内，使虚拟机能够在不同的子网间做迁移。 

（3）**Flat**：即平面网络，基于不使用VLAN的物理网络实现的虚拟网络。每个物理网络最多只能实现一个Flat虚拟网络。

（4）**Local**：本地网络，只允许在本服务器内通信的虚拟网络，不支持跨服务器的通信。主要用于单节点上测试。

（5）**GRE（Generic Routing Encapsulation）**：通用路由封装网络，使用GRE封装网络包的虚拟网络。GRE封装的数据包基于IP路由表进行路由，因此GRE不和具体的物理网络绑定。



按照创建网络的用户权限，Neutron network可分为：

（1）**Provider networ**k：由管理员创建，与网络规划相关，直接映射物理网络。Porvider network有Flat和VLAN类型，其重要属性provider:physical_network对 Flat 和 VLAN 以外的网络类型无意义。 

（2）**Tenant network**：由租户普通用户创建，受限于系统中管理员的Neutorn配置。

Openstack结合模型场景，对部分API操作进行了权限控制。默认情况下，普通用户不能创建共享的 tenant network（因此 Nuetron Server 的policy 设置了"create_network:shared": "rule:admin_only"）。这种网络是完全隔离的，不可被别的 tenant 共享。

Tenant network 有 local，flat，vlan，gre 和 vxlan 等类型。但 tenant 普通用户创建的 Flat 和 VLAN tenant network 实际还是 Provider network。所以，真正有意义的是与物理网络没有绑定关系的 GRE 和 VXLAN 类型。



#### 2. 浮动IP

正如其名字中的“浮动”的意思，浮动IP对应的设备/实例往往是动态变化的，一个浮动IP往往会随着时间变化归属于不同的设备。浮动IP可以看成是IP地址资源，它可以被动态分配，提供一批可用的IP地址。我们可以根据需要动态地将浮动IP分配给不同的设备。常见的应用场景如高可用的服务集群，提供同一服务的不同服务器有不同的IP，将浮动IP分配给其中一个服务器，并将该IP作为对外服务用的IP。当具有该浮动IP的服务器宕机时，我们可以将该浮动IP分配给其他可用的机器，这样对于外部用户来说通过原来的浮动IP依然能正常使用服务。



#### 3. OpenStack创建实例的工作过程

OpenStack中实例的创建是由多个组件间的交互来完成，在Dashboard中创建并启动实例涉及到的组件主要有Horizon，Nova，Neutron，Cinder，Keystone，Glance。这些组件的功能如下：

| 项目                      | 代码名称 | 描述                                                        |
| ------------------------- | -------- | ----------------------------------------------------------- |
| 计算（Compute）           | Nova     | 管理虚拟机资源，包括CPU、内存、磁盘和网络接口               |
| 网络（Networking）        | Neutron  | 提供虚拟机网络接口资源，如IP寻址、路由和软件定义网络（SDN） |
| 仪表盘（Dashboard）       | Horizon  | 为OpenStack提供基于Web的图形界面                            |
| 块存储（Block Storage）   | Cinder   | 为虚拟机提供块（传统磁盘）存储                              |
| 镜像服务（Image Service） | Glance   | 管理虚拟机磁盘镜像，为虚拟机和快照（备份）服务提供镜像      |

我们在Horizon组件提供的Dashboard界面上创建实例的过程中各组件的交互大致如下：

![openstack组件交互流程](images\openstack%E7%BB%84%E4%BB%B6%E4%BA%A4%E4%BA%92%E6%B5%81%E7%A8%8B.png?raw=true)

可以看出，Nova组件是该过程中较为核心的组件，负责整合虚拟机的各种资源，并支持虚拟机的运行，其他各类节点则专门管理和提供某一类资源。



### ii. 未完成工作

无



### iii. 问题与困难

网络虚拟化技术的概念比较多，且比较抽象。以下是在网上看到的一些不错的博客，均出自同一位博客巨佬，强烈推荐！

学习 Neutron 系列文章：

（1）[Neutron 所实现的网络虚拟化](https://www.cnblogs.com/sammyliu/p/4622563.html%20)

（2）[Neutron OpenvSwitch + VLAN 虚拟网络](http://www.cnblogs.com/sammyliu/p/4626419.html%20)

（3）[Neutron OpenvSwitch + GRE/VxLAN 虚拟网络](http://www.cnblogs.com/sammyliu/p/4627230.html%20)

（4）[Neutron Linux Bridge + VLAN/VXLAN 虚拟网络](https://www.cnblogs.com/sammyliu/p/5999612.html%20)

（5）[Linux bridge + VXLAN 详解](http://www.cnblogs.com/sammyliu/p/4985907.html)

（6）[Neutron OVS OpenFlow 流表 和 L2 Population](http://www.cnblogs.com/sammyliu/p/4633814.html%20)

（7）[Neutron DHCP Agent](http://www.cnblogs.com/sammyliu/p/4419195.html)

（8）[Neutron L3 Agent](http://www.cnblogs.com/sammyliu/p/4636091.html%20)  

（9）[Neutron LBaas](http://www.cnblogs.com/sammyliu/p/4656176.html%20)

（10）[Neutron Security Group](http://www.cnblogs.com/sammyliu/p/4658746.html%20)

（11）[Neutron FWaas 和 Nova Security Group](http://www.cnblogs.com/sammyliu/p/4675991.html)

（12）[Neutron VPNaas](http://www.cnblogs.com/sammyliu/p/4677386.html%20)

（13）[Neutron DVR](http://www.cnblogs.com/sammyliu/p/4713562.html)

（14）[Neutron VRRP](http://www.cnblogs.com/sammyliu/p/4692081.html)

（15）[High Availability （HA）](http://www.cnblogs.com/sammyliu/p/4741967.html)



## 下周工作计划

更进一步学习OpenStack各节点的工作原理，在OpenStack平台上进行更多的尝试。



## 建议与意见

TA提供的task2操作文档非常详细！赞！